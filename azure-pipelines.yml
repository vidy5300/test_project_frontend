trigger:
  - main

pool:
  vmImage: "ubuntu-latest"

variables:
  - group: "TestProject"  # Define the group first, this is where the variable VITE_API_URL is defined
  - name: nodeVersion
    value: "22.x"
  - name: staticWebAppName
    value: "testpipelinefrontend"

stages:
  - stage: Deploy
    displayName: "Deploy to Azure Static Web App"
    jobs:
      - job: Deploy
        displayName: "Deploy to Azure Static Web App"
        steps:
          - task: NodeTool@0
            inputs:
              versionSpec: '$(nodeVersion)'
            displayName: 'Install Node.js'

          # âœ… Inject VITE_API_URL into a .env file for Vite to pick up
          - script: |
              echo "VITE_API_URL=$VITE_API_URL" >> .env
              cat .env
            displayName: "Create .env file with VITE_API_URL"

          - task: AzureStaticWebApp@0
            inputs:
              app_location: '.'
              api_location: ''
              output_location: 'dist'
              azure_static_web_apps_api_token: '$(AZURE_STATIC_WEB_APPS_API_TOKEN)'

